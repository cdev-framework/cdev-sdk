{
    "services": [
        {
            "service": "iam",
            "folder": "2010-05-08",
            "resources": [
                {
                    "name": "Policy",
                    "ruuid": "cdev::aws::iam::policy",
                    "create": "CreatePolicy",
                    "remove": {
                        "action": "DeletePolicy",
                        "overrides": {"PolicyArn": "Arn"}
                    },
                    "update": "CreatePolicyVersion"
                },
                {
                    "name": "Role",
                    "ruuid": "cdev::aws::iam::role",
                    "create": "CreateRole",
                    "remove": "DeleteRole",
                    "update": "UpdateRole"
                },
                {
                    "name": "ManagedPolicyRoleAttachment",
                    "ruuid": "cdev::aws::iam::managedpolicyroleattachment",
                    "create": "AttachRolePolicy",
                    "remove": "DetachRolePolicy"
                },
                {
                    "name": "InlinePolicyRoleAttachment",
                    "ruuid": "cdev::aws::iam::managedpolicyroleattachment",
                    "create": "PutRolePolicy",
                    "remove": "DeleteRolePolicy"
                }
            ]
        },
        {
            "service": "dynamodb",
            "folder": "2012-08-10",
            "resources": [
                {
                    "name": "Table",
                    "ruuid": "cdev::aws::dynamodb::table",
                    "create": {
                        "action": "CreateTable",
                        "waits": "TableExists"
                    },
                    "update": "UpdateTable",
                    "remove": {
                        "action": "DeleteTable",
                        "waits": "TableNotExists"
                    }
                }
            ]
        },
        {
            "service": "s3",
            "folder": "2006-03-01",
            "resources": [
                {
                    "name": "Bucket",
                    "ruuid": "cdev::aws::s3::bucket",
                    "create": "CreateBucket",
                    "remove": "DeleteBucket"
                },
                {
                    "name": "Object",
                    "ruuid": "cdev::aws::s3::object",
                    "create": "PutObject",
                    "remove": "DeleteObject"
                }
            ]
        },
        {
            "service": "lambda",
            "folder": "2015-03-31",
            "resources": [
                {
                    "name": "LambdaFunction",
                    "ruuid": "cdev::aws::lambda::function",
                    "create": "CreateFunction",
                    "remove": "DeleteFunction"
                }
            ]
        },
        {
            "service": "sqs",
            "folder": "2012-11-05",
            "resources": [
                {
                    "name": "Queue",
                    "ruuid": "cdev::aws::sqs::queue",
                    "create": "CreateQueue",
                    "remove": "DeleteQueue"
                }
            ]
        },
        {
            "service": "apigatewayv2",
            "folder": "2018-11-29",
            "resources": [
                {
                    "name": "Api",
                    "ruuid": "cdev::aws::apigatewayv2::api",
                    "create": "CreateApi",
                    "update": "UpdateApi",
                    "remove": "DeleteApi"
                },
                {
                    "name": "Route",
                    "ruuid": "cdev::aws::apigatewayv2::route",
                    "create": {
                        "action": "CreateRoute",
                        "additional_info": ["ApiId"]
                    },
                    "update": "UpdateRoute",
                    "remove": "DeleteRoute"
                },
                {
                    "name": "Integration",
                    "ruuid": "cdev::aws::apigatewayv2::integration",
                    "create": {
                        "action": "CreateIntegration",
                        "additional_info": ["ApiId"]
                    },
                    "update": "UpdateIntegration",
                    "remove": "DeleteIntegration"
                },
                {
                    "name": "Stage",
                    "ruuid": "cdev::aws::apigatewayv2::stage",
                    "create": {
                        "action": "CreateStage",
                        "additional_info": ["ApiId"]
                    },
                    "update": "UpdateStage",
                    "remove": "DeleteStage"
                },
                {
                    "name": "Deployment",
                    "ruuid": "cdev::aws::apigatewayv2::deployment",
                    "create": {
                        "action": "CreateDeployment",
                        "additional_info": ["ApiId"]
                    },
                    "update": "UpdateDeployment",
                    "remove": "DeleteDeployment"
                }

            ]
        },
        {
            "service": "apigateway",
            "folder": "2015-07-09",
            "resources": [
                {
                    "name": "RestApi",
                    "ruuid": "cdev::aws::apigateway::restapi",
                    "create": {
                        "action": "CreateRestApi",
                        "extra_info" : {
                            "needs": "[{'final_name': 'root_resource_id', 'key': 'items', 'transform': lambda x: x[0].get('id')}]",
                            "arg_keys": "{'id': 'restApiId' }",
                            "function_name": "get_resources",
                            "all_keys": [
                                "root_resource_id"
                            ]
                        }
                    },
                    "remove": {
                        "action": "DeleteRestApi",
                        "overrides": {"restApiId": "id"}
                    }
                },
                {
                    "name": "Resource",
                    "ruuid": "cdev::aws::apigateway::resource",
                    "create": {
                        "action": "CreateResource",
                        "additional_info": ["restApiId"]
                    },
                    "remove": {
                        "action": "DeleteResource",
                        "overrides": {"resourceId": "id"}
                    }
                },
                {
                    "name": "Integration",
                    "ruuid": "cdev::aws::apigateway::integration",
                    "create": {
                        "action": "PutIntegration",
                        "additional_info": ["restApiId", "resourceId", "httpMethod"]
                    },
                    "update": "UpdateIntegration",
                    "remove": "DeleteIntegration"
                },
                {
                    "name": "Stage",
                    "ruuid": "cdev::aws::apigateway::stage",
                    "create": {
                        "action": "CreateStage",
                        "additional_info": ["restApiId"]
                    },
                    "update": "UpdateStage",
                    "remove": "DeleteStage"
                },
                {
                    "name": "IntegrationResponse",
                    "ruuid": "cdev::aws::apigateway::integration_response",
                    "create": {
                        "action": "PutIntegrationResponse",
                        "additional_info": ["restApiId", "resourceId", "httpMethod"],
                        "undocumented_required": [["selectionPattern", "''"]]
                    },
                    "update": "UpdateIntegrationResponse",
                    "remove": "DeleteIntegrationResponse"
                },
                {
                    "name": "Method",
                    "ruuid": "cdev::aws::apigateway::method",
                    "create": {
                        "action": "PutMethod",
                        "additional_info": ["restApiId", "resourceId"]
                    },
                    "update": "UpdateMethod",
                    "remove": "DeleteMethod"
                },
                {
                    "name": "MethodResponse",
                    "ruuid": "cdev::aws::apigateway::method_response",
                    "create": {
                        "action": "PutMethodResponse",
                        "additional_info": ["restApiId", "resourceId", "httpMethod"]
                    },
                    "update": "UpdateMethodResponse",
                    "remove": "DeleteMethodResponse"
                },
                {
                    "name": "Deployment",
                    "ruuid": "cdev::aws::apigateway::deployment",
                    "create": {
                        "action": "CreateDeployment",
                        "additional_info": ["restApiId", "deploymentId"]
                    },
                    "update": "UpdateDeployment",
                    "remove": { 
                        "action": "DeleteDeployment",
                        "overrides": {"deploymentId": "id"}
                    }
                }

            ]
        }
    ]
}
